# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
      - master
jobs:
  deploy_firebase:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v3
      - name: ‚éî Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 16.18.1
          cache: yarn
      - run: node --version && yarn install
        env:
          YARN_ENABLE_IMMUTABLE_INSTALLS: false
      - run: yarn build
      - name: üöÄ Deploy
        working-directory: apps/firebase
        run: |
          echo Deploying...
          echo $FIREBASE_DIRECTORY
          echo $GOOGLE_APPLICATION_CREDENTIALS
          cd ./functions && pwd && yarn build
          echo pwd
          yarn service-account:decode
          yarn deploy || rm $GOOGLE_APPLICATION_CREDENTIALS
          rm $GOOGLE_APPLICATION_CREDENTIALS
        env:
          SERVICE_ACCOUNT_BASE64: '${{ secrets.SERVICE_ACCOUNT_BASE64 }}'
          GOOGLE_APPLICATION_CREDENTIALS: ${{ github.workspace }}/apps/firebase/service-account.json
          FIREBASE_DIRECTORY: ${{ github.workspace }}/app/firebase
