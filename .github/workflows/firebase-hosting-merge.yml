# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
      - master
jobs:
  deploy_firebase:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v3
      - name: ‚éî Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 16.18.1
          cache: yarn
      - run: node --version && yarn install
        env:
          YARN_ENABLE_IMMUTABLE_INSTALLS: false
      - run: yarn build
      - name: üöÄ Deploy
        run: |
          cd $GITHUB_WORKSPACE/apps/firebase/functions
          yarn build
          cd $GITHUB_WORKSPACE/apps/firebase
          yarn service-account:decode
          echo $GOOGLE_APPLICATION_CREDENTIALS
          yarn deploy
          rm $GOOGLE_APPLICATION_CREDENTIALS
        env:
          SERVICE_ACCOUNT_BASE64: '${{ secrets.SERVICE_ACCOUNT_BASE64 }}'
          GOOGLE_APPLICATION_CREDENTIALS: ${{ env.GITHUB_WORKSPACE }}/apps/firebase/service-account.json
